(()=>{var l=e=>document.getElementById(e),u=e=>document.querySelectorAll(e),b=()=>Math.round(new Date().getTime()/Math.random()),g=(e,t={},r=[])=>{let s=document.createElement(e);return Object.entries(t).map(([i,n])=>s[i]=n),r.map(i=>s.append(i)),s},d=(e,t)=>t===void 0?JSON.parse(localStorage.getItem(e)):localStorage.setItem(e,JSON.stringify(t)),T=e=>{let t=new Blob([JSON.stringify(e)],{type:"application/json"});return URL.createObjectURL(t)};function y(e,t){let r=e.target,s=r.value,i=r.selectionEnd,n=o.items.indexOf(t),c=n-1,I=n+1;switch(e.key){case"Backspace":if(i===0&&o.items.length>1){e.preventDefault();let h=o.items[c],_=h?h.name:"";h?(h.name=_+s,o.focusTo(c,_.length)):o.focusTo(n,0),t.delete()}break;case"Enter":let N=s.slice(i),w=n+1;t.name=s.substr(0,i),o.addItem(new a({name:N}),w),o.focusTo(w,0);break;case"ArrowUp":if(!o.items[c])break;e.preventDefault(),o.focusTo(c,i);break;case"ArrowDown":if(!o.items[I])break;e.preventDefault(),o.focusTo(I,i);break}}var m=render=()=>{o.element.innerHTML="",o.items.forEach((e,t)=>{let r=g("input",{type:"checkbox",checked:e.done});r.oninput=n=>e.done=n.target.checked,r.onmousedown=drag.started,r.ontouchstart=drag.started;let s=g("input",{type:"text",value:e.name,placeholder:"Untitled"});t==0&&(s.autofocus=!0),s.oninput=n=>e.name=n.target.value,s.onkeydown=n=>y(n,e);let i=g("li",{id:e.id},[r,s]);o.element.append(i),o.save()})};var x=class{constructor(t,r){this.element=t,this.items=r||[]}save(){d("checklist",this.items);let t=l("export");t.href=T(o),t.download=`big_list_${new Date().toLocaleDateString()}.json`}focusTo(t,r){setTimeout(()=>{let i=l(this.items[t].id).querySelector('input[type="text"]');i.focus(),i.setSelectionRange(r,r)},5)}addItem(t=new a,r=this.items.length){this.items.splice(r,0,t),m(),this.focusTo(r)}},a=class{constructor(t={}){this.id=b(),this.name=t.name||"",this.done=t.done||!1}delete(){let t=o.items.indexOf(this);o.items.splice(t,1),m()}};var O=l("checklist"),v=d("checklist"),S=v?v.map(e=>new a(e)):[new a],D=new x(O,S),o=D;var p=!1,E,k=0,A=e=>E=setTimeout(()=>p=e,150),f=drag={started(e){A(e.target.closest("li"))},moved(e){requestAnimationFrame(()=>{if(!p)return;document.documentElement.classList.add("noscroll"),k=0;let r=e.touches?e.touches[0].pageY:e.clientY;p.classList.add("drug");for(let s of u("li:not(.drug)")){let i=s.getBoundingClientRect(),c=i.top+i.height/2>r;s.classList.toggle("shift",c),c||(k+=1)}})},ended(){if(p){let e=o.items.find(r=>r.id==p.id),t=o.items.indexOf(e);o.items.splice(t,1),o.items.splice(k,0,e),m()}clearTimeout(E),document.documentElement.classList.remove("noscroll"),u("li").forEach(e=>e.className=""),p=!1}};var L=[],J=()=>{let e=l("modal"),t=()=>{L.map(r=>o.items.push(new a(r))),e.classList.add("invisible"),m()};e.classList.remove("invisible"),l("combine").onclick=t,l("replace").onclick=()=>{o.items=[],t()}},$=e=>{var s;let t,r=new FileReader;((s=e.dataTransfer)==null?void 0:s.items)?(e.preventDefault(),t=e.dataTransfer.items[0].getAsFile()):e.dataTransfer?(e.preventDefault(),t=e.dataTransfer.files[0]):t=e.target.files[0],r.onerror=i=>alert(`Error importing list: ${i}`),r.onload=function(){L=JSON.parse(this.result).items,J()},r.readAsText(t)};var B=d("theme"),M=u("[data-theme]");document.body.classList.add(B);M.forEach(e=>e.onclick=()=>{let t=e.getAttribute("data-theme");document.body.className=t,d("theme",t)});ontouchmove=f.moved;onmousemove=f.moved;ontouchend=f.ended;onmouseup=f.ended;var R=l("import");R.oninput=$;addEventListener("beforeunload",()=>o.save());setInterval(()=>o.save(),1e3);m();})();
