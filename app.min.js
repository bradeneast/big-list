(()=>{var k=e=>document.getElementById(e),h=e=>document.querySelectorAll(e),f=(e,t={},n=[])=>{let s=document.createElement(e);return Object.entries(t).map(([l,i])=>s[l]=i),n.map(l=>s.append(l)),s},d=(e,t)=>{try{t==null?JSON.parse(localStorage.getItem(e)):localStorage.setItem(e,JSON.stringify(t))}catch(n){console.log(n);return}},N=k("checklist"),S="day",a=!1,w,p=0,O=e=>w=setTimeout(()=>a=e,150);function E(e){O(e.target.closest("li"))}function x(e){requestAnimationFrame(()=>{if(!a)return;document.documentElement.classList.add("noscroll"),p=0;let n=e.touches?e.touches[0].pageY:e.clientY;a.classList.add("drug");for(let s of h("li:not(.drug)")){let l=s.getBoundingClientRect(),c=l.top+l.height/2>n;s.classList.toggle("shift",c),c||(p+=1)}})}function y(e){if(a){let t=o.items.find(s=>s.id==a.id),n=o.items.indexOf(t);o.items.splice(n,1),o.items.splice(p,0,t),u()}clearTimeout(w),document.documentElement.classList.remove("noscroll"),h("li").forEach(t=>t.className=""),a=!1}function A(e,t){let n=e.target,s=n.value,l=n.selectionEnd,i=o.items.indexOf(t),c=i-1,g=i+1;switch(e.key){case"Backspace":if(l===0&&o.items.length>1){e.preventDefault();let m=o.items[c],T=m?m.name:"";m&&m.rename(T+s),t.delete(),m?o.focusTo(c,T.length):o.focusTo(i,0)}break;case"Enter":let D=s.slice(l),I=i+1;t.rename(s.substr(0,l)),o.addItem(new r({name:D}),I),o.focusTo(I,0);break;case"ArrowUp":e.preventDefault(),o.items[c]&&o.focusTo(c,l);break;case"ArrowDown":e.preventDefault(),o.items[g]&&o.focusTo(g,l);break}}var v=class{constructor(t,n){this.element=t,this.items=n||[]}save(){d("checklist",this.items)}focusTo(t,n){setTimeout(()=>{let l=k(this.items[t].id).querySelector('input[type="text"]');l.focus(),l.setSelectionRange(n,n)},5)}addItem(t=new r,n=this.items.length){this.items.splice(n,0,t),u(),this.focusTo(n)}},r=class{constructor(t={}){this.id=Math.round(new Date().getTime()/Math.random()),this.name=t.name||"",this.done=t.done||!1}setDone(t){this.done=t}toggleDone(){this.setDone(!this.done)}rename(t){this.name=t}delete(){let t=o.items.indexOf(this);o.items.splice(t,1),u()}};function u(){o.element.innerHTML="",o.items.forEach((e,t)=>{let n=f("input",{type:"checkbox",checked:e.done});n.oninput=i=>e.toggleDone(i.target.checked),n.onmousedown=E,n.ontouchstart=E;let s=f("input",{type:"text",value:e.name,placeholder:"Untitled"});t==0&&(s.autofocus=!0),s.oninput=i=>e.rename(i.target.value),s.onkeydown=i=>A(i,e);let l=f("li",{id:e.id},[n,s]);o.element.append(l),o.save()})}var b=d("checklist"),L=b?b.map(e=>new r(e)):[new r],o=new v(N,L),M=d("theme"),q=h("[data-theme]");document.body.classList.add(M||S);q.forEach(e=>e.onclick=()=>{let t=e.getAttribute("data-theme");document.body.className=t,d("theme",t)});ontouchmove=x;onmousemove=x;ontouchend=y;onmouseup=y;u();})();
