(()=>{var l=e=>document.getElementById(e),u=e=>document.querySelectorAll(e),E=()=>Math.round(new Date().getTime()/Math.random()),g=(e,t={},s=[])=>{let i=document.createElement(e);return Object.entries(t).map(([r,n])=>i[r]=n),s.map(r=>i.append(r)),i},d=(e,t)=>t===void 0?JSON.parse(localStorage.getItem(e)):localStorage.setItem(e,JSON.stringify(t)),L=e=>{let t=new Blob([JSON.stringify(e)],{type:"application/json"});return URL.createObjectURL(t)},y=e=>JSON.parse(JSON.stringify(e)),w=e=>e.classList.remove("invisible"),I=e=>e.classList.add("invisible");var x=!1,b=!1;function O(e){switch(e.key){case"z":x&&o.undo();break;case"Z":x&&b&&o.redo();break;case"Control":x=!0;break;case"Shift":b=!0;break}}function D(e){switch(e.key){case"Control":x=!1;break;case"Shift":b=!1;break}}function $(e,t){let s=e.target,i=s.value,r=s.selectionEnd,n=o.items.indexOf(t),c=n-1,v=n+1;switch(e.key){case"Backspace":if(r===0&&o.items.length>1){e.preventDefault();let f=o.items[c],N=f?f.name:"";f?(f.name=N+i,o.focusTo(c,N.length)):o.focusTo(n,0),t.delete()}break;case"Enter":let j=i.slice(r),S=n+1;t.name=i.substr(0,r),o.addItem(new a({name:j}),S),o.focusTo(S,0);break;case"ArrowUp":if(!o.items[c])break;e.preventDefault(),o.focusTo(c,r);break;case"ArrowDown":if(!o.items[v])break;e.preventDefault(),o.focusTo(v,r);break}}var m=render=()=>{o.element.innerHTML="",o.items.forEach((e,t)=>{let s=g("input",{type:"checkbox",checked:e.done});s.oninput=n=>e.setDone(n.target.checked),s.onmousedown=drag.started,s.ontouchstart=drag.started;let i=g("input",{type:"text",value:e.name,placeholder:"Untitled"});t==0&&(i.autofocus=!0),i.oninput=n=>e.setName(n.target.value),i.onkeydown=n=>$(n,e);let r=g("li",{id:e.id},[s,i]);o.element.append(r),o.save()})};var A=250,J=setTimeout(C,A);function C(){let e=l("export");e.href=L(o),e.download=`big_list_${new Date().toLocaleDateString()}.json`,d("checklist",o.items);let{states:t,index:s}=o.history;t.length-1==s&&o.makeHistory()}var _=class{constructor(t,s){this.element=t,this.items=s||[],this.history={index:0,states:[y(this.items)]}}initializeItems(t){this.items=t.map(s=>new a(s))}makeHistory(){let{history:t,items:s}=this,{states:i,index:r}=t;i.length-1!=r&&(t.states=i.slice(r),t.index=i.length-1),t.states.length>50&&t.states.splice(0,1),t.states.push(y(s)),t.index++}undo(){let{states:t,index:s}=this.history,i=t[s-1];i&&(this.initializeItems(i),this.history.index=s-1,m())}redo(){let{states:t,index:s}=this.history,i=t[s+1];i&&(this.initializeItems(i),this.history.index=s+1,m())}save(){clearTimeout(J),J=setTimeout(C,A)}focusTo(t,s){setTimeout(()=>{let r=l(this.items[t].id).querySelector('input[type="text"]');r.focus(),r.setSelectionRange(s,s)},10)}addItem(t=new a,s=this.items.length){this.items.splice(s,0,t),m(),this.focusTo(s)}},a=class{constructor(t={}){this.id=E(),this.name=t.name||"",this.done=t.done||!1}setName(t){this.name=t,o.save()}setDone(t){this.done=t,o.save()}delete(){let t=o.items.indexOf(this);o.items.splice(t,1),m()}};var q=l("checklist"),F=d("checklist"),z=F?F.map(e=>new a(e)):[new a],G=new _(q,z),o=G;var p=!1,K,T=0,H=e=>K=setTimeout(()=>p=e,250),h=drag={started(e){H(e.target.closest("li"))},moved(e){requestAnimationFrame(()=>{if(!p)return;document.documentElement.classList.add("noscroll"),T=0;let s=e.touches?e.touches[0].pageY:e.clientY;p.classList.add("drug");for(let i of u("li:not(.drug)")){let r=i.getBoundingClientRect(),c=r.top+r.height/2>s;i.classList.toggle("shift",c),c||(T+=1)}})},ended(){if(p){let e=o.items.find(s=>s.id==p.id),t=o.items.indexOf(e);o.items.splice(t,1),o.items.splice(T,0,e),m()}clearTimeout(K),document.documentElement.classList.remove("noscroll"),u("li").forEach(e=>e.className=""),p=!1}};var k=[],B=()=>{let e=l("import_config");w(e);function t(){k.map(s=>o.items.push(new a(s))),I(e),m()}l("combine").onclick=t,l("replace").onclick=()=>{o.items=[],t()}},M=e=>{var i;let t,s=new FileReader;((i=e.dataTransfer)==null?void 0:i.items)?(e.preventDefault(),t=e.dataTransfer.items[0].getAsFile()):e.dataTransfer?(e.preventDefault(),t=e.dataTransfer.files[0]):t=e.target.files[0],s.onerror=r=>alert("error importing list: "+r),s.onload=function(){k=JSON.parse(this.result).items,B()},s.readAsText(t)},R=e=>{let t=l("paste_dialogue"),s=t.querySelector("textarea");w(t),l("import_pasted").onclick=()=>{try{k=JSON.parse(s.value).items}catch(i){console.log("error importing JSON: importing as plain text"),k=s.value.split(`
`).map(n=>new a({name:n}))}I(t),B()}};var P=d("theme"),U=u("[data-theme]"),W=l("import_file"),Y=l("import_paste");document.body.classList.add(P);U.forEach(e=>e.onclick=()=>{let t=e.getAttribute("data-theme");document.body.className=t,d("theme",t)});onkeydown=O;onkeyup=D;ontouchmove=h.moved;onmousemove=h.moved;ontouchend=h.ended;onmouseup=h.ended;W.oninput=M;Y.onclick=R;onbeforeunload=o.save;m();})();
