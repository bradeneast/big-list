(()=>{var k=e=>document.getElementById(e),h=e=>document.querySelectorAll(e),f=(e,t={},s=[])=>{let o=document.createElement(e);return Object.entries(t).map(([l,i])=>o[l]=i),s.map(l=>o.append(l)),o},r=(e,t)=>t==null?JSON.parse(localStorage.getItem(e)):localStorage.setItem(e,JSON.stringify(t)),N=k("checklist"),S="day",a=!1,v,p=0,L=e=>v=setTimeout(()=>a=e,150);function w(e){L(e.target.closest("li"))}function E(e){requestAnimationFrame(()=>{if(!a)return;document.documentElement.classList.add("noscroll"),p=0;let s=e.touches?e.touches[0].pageY:e.clientY;a.classList.add("drug");for(let o of h("li:not(.drug)")){let l=o.getBoundingClientRect(),c=l.top+l.height/2>s;o.classList.toggle("shift",c),c||(p+=1)}})}function x(e){if(a){let t=n.items.find(o=>o.id==a.id),s=n.items.indexOf(t);n.items.splice(s,1),n.items.splice(p,0,t),u()}clearTimeout(v),document.documentElement.classList.remove("noscroll"),h("li").forEach(t=>t.className=""),a=!1}function O(e,t){let s=e.target,o=s.value,l=s.selectionEnd,i=n.items.indexOf(t),c=i-1,g=i+1;switch(e.key){case"Backspace":if(l===0&&n.items.length>1){e.preventDefault();let m=n.items[c],T=m?m.name:"";m&&m.rename(T+o),t.delete(),m?n.focusTo(c,T.length):n.focusTo(i,0)}break;case"Enter":let D=o.slice(l),I=i+1;t.rename(o.substr(0,l)),n.addItem(new d({name:D}),I),n.focusTo(I,0);break;case"ArrowUp":e.preventDefault(),n.items[c]&&n.focusTo(c,l);break;case"ArrowDown":e.preventDefault(),n.items[g]&&n.focusTo(g,l);break}}var b=class{constructor(t,s){this.element=t,this.items=s||[]}save(){r("checklist",this.items)}focusTo(t,s){setTimeout(()=>{let l=k(this.items[t].id).querySelector('input[type="text"]');l.focus(),l.setSelectionRange(s,s)},5)}addItem(t=new d,s=this.items.length){this.items.splice(s,0,t),u(),this.focusTo(s)}},d=class{constructor(t={}){this.id=Math.round(new Date().getTime()/Math.random()),this.name=t.name||"",this.done=t.done||!1}setDone(t){this.done=t}toggleDone(){this.setDone(!this.done)}rename(t){this.name=t}delete(){let t=n.items.indexOf(this);n.items.splice(t,1),u()}};function u(){n.element.innerHTML="",n.items.forEach((e,t)=>{let s=f("input",{type:"checkbox",checked:e.done});s.oninput=i=>e.toggleDone(i.target.checked),s.onmousedown=w,s.ontouchstart=w;let o=f("input",{type:"text",value:e.name,placeholder:"Untitled"});t==0&&(o.autofocus=!0),o.oninput=i=>e.rename(i.target.value),o.onkeydown=i=>O(i,e);let l=f("li",{id:e.id},[s,o]);n.element.append(l),n.save()})}var y=r("checklist"),A=y?y.map(e=>new d(e)):[new d],n=new b(N,A),M=r("theme"),q=h("[data-theme]");document.body.classList.add(M||S);q.forEach(e=>e.onclick=()=>{let t=e.getAttribute("data-theme");document.body.className=t,r("theme",t)});ontouchmove=E;onmousemove=E;ontouchend=x;onmouseup=x;addEventListener("beforeunload",()=>n.save());setInterval(()=>n.save(),1e3);u();})();
