(()=>{var l=e=>document.getElementById(e),h=e=>document.querySelectorAll(e),E=()=>Math.round(new Date().getTime()/Math.random()),g=(e,t={},o=[])=>{let i=document.createElement(e);return Object.entries(t).map(([r,n])=>i[r]=n),o.map(r=>i.append(r)),i},p=(e,t)=>t===void 0?JSON.parse(localStorage.getItem(e)):localStorage.setItem(e,JSON.stringify(t)),D=e=>{let t=new Blob([JSON.stringify(e)],{type:"application/json"});return URL.createObjectURL(t)},w=e=>JSON.parse(JSON.stringify(e)),I=e=>e.classList.remove("invisible"),b=e=>e.classList.add("invisible");var x=!1,_=!1;function L(e){switch(e.key){case"z":x&&s.undo();break;case"Z":x&&_&&s.redo();break;case"Control":x=!0;break;case"Shift":_=!0;break}}function O(e){switch(e.key){case"Control":x=!1;break;case"Shift":_=!1;break}}function $(e,t){let o=e.target,i=o.value,r=o.selectionEnd,n=s.items.indexOf(t),c=n-1,y=n+1;switch(e.key){case"Delete":if(r==i.length){let d=s.items[y];t.setName(t.name+d.name),d.delete(),s.focusTo(n,r)}break;case"Backspace":if(r===0&&s.items.length>1){e.preventDefault();let d=s.items[c],S=d?d.name:"";d?(d.name=S+i,s.focusTo(c,S.length)):s.focusTo(n,0),t.delete()}break;case"Enter":let q=i.slice(r),N=n+1;t.name=i.substr(0,r),s.addItem(new a({name:q}),N),s.focusTo(N,0);break;case"ArrowUp":if(!s.items[c])break;e.preventDefault(),s.focusTo(c,r);break;case"ArrowDown":if(!s.items[y])break;e.preventDefault(),s.focusTo(y,r);break}}var m=render=()=>{s.element.innerHTML="",s.items.forEach((e,t)=>{let o=g("input",{type:"checkbox",checked:e.done});o.oninput=n=>e.setDone(n.target.checked),o.onmousedown=drag.started,o.ontouchstart=drag.started;let i=g("input",{type:"text",value:e.name,placeholder:"Untitled"});t==0&&(i.autofocus=!0),i.oninput=n=>e.setName(n.target.value),i.onkeydown=n=>$(n,e);let r=g("li",{id:e.id},[o,i]);s.element.append(r),s.save()})};var k=[],A=()=>{let e=l("import_config");I(e);function t(){k.map(o=>s.items.push(new a(o))),b(e),m()}l("combine").onclick=t,l("replace").onclick=()=>{s.items=[],t()}},J=e=>{var i;let t,o=new FileReader;((i=e.dataTransfer)==null?void 0:i.items)?(e.preventDefault(),t=e.dataTransfer.items[0].getAsFile()):e.dataTransfer?(e.preventDefault(),t=e.dataTransfer.files[0]):t=e.target.files[0],o.onerror=r=>alert("error importing list: "+r),o.onload=function(){k=JSON.parse(this.result),A()},o.readAsText(t)},C=e=>{let t=l("paste_dialogue"),o=t.querySelector("textarea");I(t),l("import_pasted").onclick=()=>{try{k=JSON.parse(o.value)}catch(i){console.log("error importing JSON: importing as plain text"),k=o.value.split(`
`).map(n=>new a({name:n}))}b(t),A()}},F=()=>{let e=l("export");e.href=D(s.items),e.download=`big_list_${new Date().toLocaleDateString()}.json`};var K=250,B=setTimeout(M,K);function M(){F(),p("checklist",s.items);let{states:e,index:t}=s.history;e.length-1==t&&s.makeHistory()}var T=class{constructor(t,o){this.element=t,this.items=o||[],this.history={index:0,states:[w(this.items)]}}initializeItems(t){this.items=t.map(o=>new a(o))}makeHistory(){let{history:t,items:o}=this,{states:i,index:r}=t;i.length-1!=r&&(t.states=i.slice(r),t.index=i.length-1),t.states.length>50&&t.states.splice(0,1),t.states.push(w(o)),t.index++}undo(){let{states:t,index:o}=this.history,i=t[o-1];i&&(this.initializeItems(i),this.history.index=o-1,m())}redo(){let{states:t,index:o}=this.history,i=t[o+1];i&&(this.initializeItems(i),this.history.index=o+1,m())}save(){clearTimeout(B),B=setTimeout(M,K)}focusTo(t,o){setTimeout(()=>{let r=l(this.items[t].id).querySelector('input[type="text"]');r.focus(),r.setSelectionRange(o,o)},10)}addItem(t=new a,o=this.items.length){this.items.splice(o,0,t),m(),this.focusTo(o)}},a=class{constructor(t={}){this.id=E(),this.name=t.name||"",this.done=t.done||!1}setName(t){this.name=t,s.save()}setDone(t){this.done=t,s.save()}delete(){let t=s.items.indexOf(this);s.items.splice(t,1),m()}};var z=l("checklist"),R=p("checklist"),G=R?R.map(e=>new a(e)):[new a],H=new T(z,G),s=H;var u=!1,j,v=0,P=e=>j=setTimeout(()=>u=e,250),f=drag={started(e){P(e.target.closest("li"))},moved(e){requestAnimationFrame(()=>{if(!u)return;document.documentElement.classList.add("noscroll"),v=0;let o=e.touches?e.touches[0].pageY:e.clientY;u.classList.add("drug");for(let i of h("li:not(.drug)")){let r=i.getBoundingClientRect(),c=r.top+r.height/2>o;i.classList.toggle("shift",c),c||(v+=1)}})},ended(){if(u){let e=s.items.find(o=>o.id==u.id),t=s.items.indexOf(e);s.items.splice(t,1),s.items.splice(v,0,e),m()}clearTimeout(j),document.documentElement.classList.remove("noscroll"),h("li").forEach(e=>e.className=""),u=!1}};var U=p("theme"),W=h("[data-theme]"),Y=l("import_file"),V=l("import_paste");document.body.classList.add(U);W.forEach(e=>e.onclick=()=>{let t=e.getAttribute("data-theme");document.body.className=t,p("theme",t)});onkeydown=L;onkeyup=O;ontouchmove=f.moved;onmousemove=f.moved;ontouchend=f.ended;onmouseup=f.ended;Y.oninput=J;V.onclick=C;onbeforeunload=s.save;m();})();
