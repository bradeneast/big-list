(()=>{var l=e=>document.getElementById(e),u=e=>document.querySelectorAll(e),O=()=>Math.round(new Date().getTime()/Math.random()),g=(e,t={},i=[])=>{let s=document.createElement(e);return Object.entries(t).map(([n,r])=>s[n]=r),i.map(n=>s.append(n)),s},p=(e,t)=>t===void 0?JSON.parse(localStorage.getItem(e)):localStorage.setItem(e,JSON.stringify(t)),$=e=>{let t=new Blob([JSON.stringify(e)],{type:"application/json"});return URL.createObjectURL(t)},y=e=>JSON.parse(JSON.stringify(e)),w=e=>e.classList.remove("invisible"),f=e=>e.classList.add("invisible");var x=!1,I=!1,h=!1,C,_=0,U=e=>C=setTimeout(()=>h=e,250);function T(e){U(e.target.closest("li"))}function v(e){requestAnimationFrame(()=>{if(!h)return;document.documentElement.classList.add("noscroll"),_=0;let i=e.touches?e.touches[0].pageY:e.clientY;h.classList.add("drug");for(let s of u("li:not(.drug)")){let n=s.getBoundingClientRect(),m=n.top+n.height/2>i;s.classList.toggle("shift",m),m||(_+=1)}})}function E(){if(h){let e=o.items.find(i=>i.id==h.id),t=o.items.indexOf(e);o.items.splice(t,1),o.items.splice(_,0,e),a(),document.activeElement.focus(),document.activeElement.blur()}clearTimeout(C),document.documentElement.classList.remove("noscroll"),u("li").forEach(e=>e.className=""),h=!1}function A(e){switch(e.key){case"z":x&&o.undo();break;case"Z":x&&I&&o.redo();break;case"Control":x=!0;break;case"Shift":I=!0;break}}function M(e){switch(e.key){case"Control":x=!1;break;case"Shift":I=!1;break}}function J(e,t){let i=e.target,s=i.value,n=i.selectionEnd,r=o.items.indexOf(t),m=r-1,b=r+1;switch(e.key){case"Delete":if(n==s.length){let d=o.items[b];t.setName(t.name+d.name),d.delete(),o.focusTo(r,n)}break;case"Backspace":if(n===0&&o.items.length>1){e.preventDefault();let d=o.items[m],D=d?d.name:"";d?(d.name=D+s,o.focusTo(m,D.length)):o.focusTo(r,0),t.delete()}break;case"Enter":let P=s.slice(n),L=r+1;t.name=s.substr(0,n),o.addItem(new c({name:P}),L),o.focusTo(L,0);break;case"ArrowUp":if(!o.items[m])break;e.preventDefault(),o.focusTo(m,n);break;case"ArrowDown":if(!o.items[b])break;e.preventDefault(),o.focusTo(b,n);break}}function S({target:e}){e==o.element&&o.items[o.items.length-1].name.length&&o.addItem(),e.classList.contains("cancel")&&u(".modal").forEach(t=>f(t))}var a=render=()=>{o.element.innerHTML="",o.items.forEach((e,t)=>{let i=g("input",{type:"checkbox",checked:e.done});i.oninput=r=>e.setDone(r.target.checked),i.onmousedown=T,i.ontouchstart=T,i.onblur=o.trim;let s=g("input",{type:"text",value:e.name,placeholder:"Untitled"});t==0&&(s.autofocus=!0),s.oninput=r=>e.setName(r.target.value),s.onkeydown=r=>J(r,e),s.onblur=o.trim;let n=g("li",{id:e.id},[i,s]);o.element.append(n),o.save()})};var k=[];function F(){let e=l("import_config");w(e);function t(){k.map(i=>o.items.push(new c(i))),f(e),a()}l("combine").onclick=t,l("replace").onclick=()=>{o.items=[],t()}}function K(e){var s;let t,i=new FileReader;((s=e.dataTransfer)==null?void 0:s.items)?(e.preventDefault(),t=e.dataTransfer.items[0].getAsFile()):e.dataTransfer?(e.preventDefault(),t=e.dataTransfer.files[0]):t=e.target.files[0],i.onerror=n=>alert("error importing list: "+n),i.onload=function(){k=JSON.parse(this.result),F()},i.readAsText(t)}function B(e){let t=l("paste_dialogue"),i=t.querySelector("textarea");w(t),l("import_pasted").onclick=()=>{try{k=JSON.parse(i.value)}catch(s){k=i.value.split(`
`).map(n=>new c({name:n}))}f(t),F()}}function R(){let e=l("export");e.href=$(o.items),e.download=`big_list_${new Date().toLocaleDateString()}.json`}var j=250,q=setTimeout(z,j);function z(){R(),p("checklist",o.items);let{states:e,index:t}=o.history;e.length-1==t&&o.makeHistory()}var N=class{constructor(t,i){this.element=t,this.items=i||[],this.history={index:0,states:[y(this.items)]}}initializeItems(t){this.items=t.map(i=>new c(i))}makeHistory(){let{history:t,items:i}=this,{states:s,index:n}=t;s.length-1!=n&&(t.states=s.slice(n),t.index=s.length-1),t.states.length>50&&t.states.splice(0,1),t.states.push(y(i)),t.index++}undo(){let{states:t,index:i}=this.history,s=t[i-1];s&&(this.initializeItems(s),this.history.index=i-1,a())}redo(){let{states:t,index:i}=this.history,s=t[i+1];s&&(this.initializeItems(s),this.history.index=i+1,a())}save(){clearTimeout(q),q=setTimeout(z,j)}focusTo(t,i){setTimeout(()=>{let n=l(this.items[t].id).querySelector('input[type="text"]');n.focus(),n.setSelectionRange(i,i)},10)}addItem(t=new c,i=this.items.length){this.items.splice(i,0,t),a(),this.focusTo(i)}},c=class{constructor(t={}){this.id=O(),this.name=t.name||"",this.done=t.done||!1}setName(t){this.name=t,o.save()}setDone(t){this.done=t,o.save()}delete(){let t=o.items.indexOf(this);o.items.splice(t,1),a()}};var W=l("checklist"),H=p("checklist"),Y=H?H.map(e=>new c(e)):[new c],V=new N(W,Y),o=V;var Z=p("theme"),G=u("[data-theme]"),Q=l("import_file"),X=l("import_paste");document.body.classList.add(Z);G.forEach(e=>e.onclick=()=>{let t=e.getAttribute("data-theme");document.body.className=t,p("theme",t)});onclick=S;ontouchstart=S;onkeydown=A;onkeyup=M;ontouchmove=v;onmousemove=v;ontouchend=E;onmouseup=E;Q.oninput=K;X.onclick=B;onbeforeunload=o.save;a();})();
