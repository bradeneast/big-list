(()=>{var x=e=>document.getElementById(e),k=e=>document.querySelectorAll(e),N=x("checklist"),a=!1,T,g=0,M=e=>T=setTimeout(()=>a=e,150);function w(e){M(e.target.closest("li"))}function b(e){requestAnimationFrame(()=>{if(!a)return;g=0;let i=e.touches?e.touches[0].pageY:e.clientY;a.classList.add("drug");for(let s of k("li:not(.drug)")){let o=s.getBoundingClientRect(),c=o.top+o.height/2>i;s.classList.toggle("shift",c),c||(g+=1)}})}function y(e){if(a){let t=n.items.find(s=>s.id==a.id),i=n.items.indexOf(t);n.items.splice(i,1),n.items.splice(g,0,t),h()}clearTimeout(T),k("li").forEach(t=>t.className=""),a=!1}var S=class{constructor(t,i){this.element=t,this.items=i||[]}save(){localStorage.setItem("checklist",JSON.stringify(this.items))}focusTo(t,i){setTimeout(()=>{let o=x(this.items[t].id).querySelector('input[type="text"]');o.focus(),o.setSelectionRange(i,i)},20)}addItem(t=new r,i=this.items.length){this.items.splice(i,0,t),h(),this.focusTo(i)}},r=class{constructor(t={}){this.id=Math.round(new Date().getTime()/Math.random()),this.name=t.name||"",this.done=t.done||!1}setDone(t){this.done=t}toggleDone(){this.setDone(!this.done)}rename(t){this.name=t}delete(){let t=n.items.indexOf(this);n.items.splice(t,1),h()}};function h(){n.element.innerHTML="",n.items.forEach((e,t)=>{let i=document.createElement("li");i.id=e.id;let s=document.createElement("input");s.type="checkbox",s.checked=e.done,s.oninput=l=>e.toggleDone(l.target.checked),s.onmousedown=w,s.ontouchstart=w;let o=document.createElement("input");o.type="text",o.value=e.name,o.placeholder="Untitled",o.oninput=l=>e.rename(l.target.value),o.onkeydown=l=>{let c=l.target,p=c.value,m=c.selectionEnd,f=n.items.indexOf(e),u=f-1,I=f+1;switch(l.key){case"Backspace":if(m===0){let d=n.items[u],E=d?d.name:"";d&&d.rename(E+p),e.delete(),d&&n.focusTo(u,E.length)}break;case"Enter":let L=p.slice(m),v=f+1;e.rename(p.substr(0,m)),n.addItem(new r({name:L}),v),n.focusTo(v,0);break;case"ArrowUp":l.preventDefault(),n.items[u]&&n.focusTo(u,m);break;case"ArrowDown":l.preventDefault(),n.items[I]&&n.focusTo(I,m);break}},i.append(s),i.append(o),n.element.append(i),n.save()})}var D=localStorage.getItem("checklist"),O=D?JSON.parse(D).map(e=>new r(e)):[new r],n=new S(N,O);addEventListener("beforeunload",()=>n.save());addEventListener("touchmove",b);addEventListener("mousemove",b);addEventListener("mouseup",y);addEventListener("touchend",y);h();setInterval(()=>n.save(),1e3);})();
