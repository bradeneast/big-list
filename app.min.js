(()=>{var T=e=>document.getElementById(e),g=e=>document.querySelectorAll(e),N=T("checklist"),A="day",a=!1,x,I=0,M=e=>x=setTimeout(()=>a=e,150);function w(e){M(e.target.closest("li"))}function y(e){requestAnimationFrame(()=>{if(!a)return;document.documentElement.classList.add("noscroll"),I=0;let s=e.touches?e.touches[0].pageY:e.clientY;a.classList.add("drug");for(let l of g("li:not(.drug)")){let o=l.getBoundingClientRect(),c=o.top+o.height/2>s;l.classList.toggle("shift",c),c||(I+=1)}})}function L(e){if(a){let t=n.items.find(l=>l.id==a.id),s=n.items.indexOf(t);n.items.splice(s,1),n.items.splice(I,0,t),h()}clearTimeout(x),document.documentElement.classList.remove("noscroll"),g("li").forEach(t=>t.className=""),a=!1}var S=class{constructor(t,s){this.element=t,this.items=s||[]}save(){localStorage.setItem("checklist",JSON.stringify(this.items))}focusTo(t,s){setTimeout(()=>{let o=T(this.items[t].id).querySelector('input[type="text"]');o.focus(),o.setSelectionRange(s,s)},20)}addItem(t=new r,s=this.items.length){this.items.splice(s,0,t),h(),this.focusTo(s)}},r=class{constructor(t={}){this.id=Math.round(new Date().getTime()/Math.random()),this.name=t.name||"",this.done=t.done||!1}setDone(t){this.done=t}toggleDone(){this.setDone(!this.done)}rename(t){this.name=t}delete(){let t=n.items.indexOf(this);n.items.splice(t,1),h()}};function h(){n.element.innerHTML="",n.items.forEach((e,t)=>{let s=document.createElement("li");s.id=e.id;let l=document.createElement("input");l.type="checkbox",l.checked=e.done,l.oninput=i=>e.toggleDone(i.target.checked),l.onmousedown=w,l.ontouchstart=w;let o=document.createElement("input");o.type="text",o.value=e.name,o.placeholder="Untitled",o.oninput=i=>e.rename(i.target.value),o.onkeydown=i=>{let c=i.target,f=c.value,d=c.selectionEnd,p=n.items.indexOf(e),u=p-1,v=p+1;switch(i.key){case"Backspace":if(d===0){let m=n.items[u],k=m?m.name:"";m&&m.rename(k+f),e.delete(),m&&n.focusTo(u,k.length)}break;case"Enter":let D=f.slice(d),E=p+1;e.rename(f.substr(0,d)),n.addItem(new r({name:D}),E),n.focusTo(E,0);break;case"ArrowUp":i.preventDefault(),n.items[u]&&n.focusTo(u,d);break;case"ArrowDown":i.preventDefault(),n.items[v]&&n.focusTo(v,d);break}},s.append(l),s.append(o),n.element.append(s),n.save()})}var b=localStorage.getItem("checklist"),O=localStorage.getItem("theme"),q=b?JSON.parse(b).map(e=>new r(e)):[new r],n=new S(N,q);document.body.classList.add(O||A);g("[data-theme]").forEach(e=>e.addEventListener("click",()=>{let t=e.getAttribute("data-theme");document.body.className=t,localStorage.setItem("theme",t)}));addEventListener("beforeunload",()=>n.save());addEventListener("touchmove",y);addEventListener("mousemove",y);addEventListener("mouseup",L);addEventListener("touchend",L);h();setInterval(()=>n.save(),1e3);})();
